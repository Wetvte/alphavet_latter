<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Личный кабинет</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(0deg, #f0f8ff 0%, #bce0ff 100%);
      background-size: 200% 200%;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px 0;
    }

    .container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .content-panel {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      position: relative;
    }

    .header {
      padding: 30px 40px 20px;
    }

    .title {
      text-align: center;
      color: #272626;
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .divider {
      height: 1px;
      background-color: #e0e0e0;
      margin: 0 auto 25px;
      max-width: 90%;
    }
    .user-info {
      padding: 0 40px 25px;
    }
    .user-info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 16px;
      color: #4d4a4a;
    }
    .user-label {
      font-weight: bold;
      min-width: 100px;
    }
    .user-info-value {
      color: #333;
      flex-grow: 1;
    }

    .logout-buttons {
      padding: 0 40px 30px;
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .button.logout {
      background-color: #0b55b7;
      color: white;
    }

    .button.logout-all {
      background-color: #d80303;
      color: white;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .section {
      padding: 25px 40px;
      border-top: 1px solid #e0e0e0;
    }

    .section-title {
      font-size: 20px;
      color: #0b55b7;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .section-content {
      color: #555;
      line-height: 1.6;
    }

    .footer {
      padding: 25px 40px;
      text-align: center;
      color: #666;
      font-size: 14px;
      border-top: 1px solid #e0e0e0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="content-panel">
      <!-- Заголовок -->
      <div class="header">
        <h1 class="title">Личный кабинет</h1>
        <div class="divider"></div>
      </div>

      <!-- Данные пользователя -->
      <div class="user-info">
        <div class="user-info-row">
          <span class="user-label">Никнейм:</span>
          <span id="nameText" class="user-info-value">Unknown</span>
        </div>
        <div class="user-info-row">
          <span class="user-label">Почта:</span>
          <span id="emailText" class="user-info-value">Not linked</span>
        </div>
        <div class="divider"></div>
      </div>

      <!-- Кнопки выхода -->
      <div class="logout-buttons">
        <button id="logoutButton" class="button logout" onclick="location.href='/logout.html'">
          Выход
        </button>
        <button id="logoutAllButton" class="button logout-all" onclick="location.href='/logout.html?all=true'">
          Выход со всех устройств
        </button>
      </div>

      <!-- Раздел "На главную" -->
      <div class="section">
        <h2 class="section-title">На главную</h2>
        <div class="section-content">
          Здесь вы можете вернуться на главную страницу сайта, чтобы ознакомиться с основными разделами и новостями.
          Кнопка перехода расположена в верхнем меню сайта.
        </div>
      </div>

      <!-- Раздел "Тесты" -->
      <div class="section">
        <h2 class="section-title">Тесты</h2>
        <div class="section-content">
          В этом разделе представлены все доступные тесты по дисциплинам. Вы можете:
          <ul>
            <li>просмотреть список тестов;</li>
            <li>ознакомиться с результатами пройденных тестов;</li>
            <li>начать новый тест;</li>
            <li>посмотреть статистику выполнения.</li>
          </ul>
        </div>
      </div>

      <!-- Раздел "Дисциплины" -->
      <div class="section">
        <h2 class="section-title">Дисциплины</h2>
        <div class="section-content">
          Список ваших дисциплин с возможностью:
          <ul>
            <li>просмотра учебного плана;</li>
            <li>доступа к материалам курса;</li>
            <li>проверки текущих заданий;</li>
            <li>связи с преподавателем.</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Подвал -->
      <div class="footer">
        Сигарёв Глеб Андреевич, ПИ-251(1).
      </div>
    </div>
  </div>

  <script>
    let nameText;
    let emailText;

    let logoutButton;
    let logoutAllButton;

    const web_server_url = "http://localhost:3000";
    // Отправка пост запросов к Web Client"у (возвращает response)
    async function send_data_to_webclient(page, data={}, token=undefined, error_callback=undefined) {
        const target_url = `${web_server_url}/${page}`;
        console.log("Отправка данных по URL: " + target_url)
        try {
            const response = await fetch(target_url, {
                method: "POST",
                headers: token ? {
                "Authorization": "Bearer " + token,
                "Content-Type": "application/json"
                } : {
                "Content-Type": "application/json"
                },
                body: JSON.stringify(data),
                credentials: "include" // для передачи куки
            });
            if (!response.ok) {
            if (error_callback) error_callback("Ошибка при приёме данных.");
            return;
            }
            return await response.json(); // Возвращаем json с данными, как ответ
        } catch (error) {
            if (error_callback) error_callback("Ошибка при приёме данных.");
        }
    }
    async function get_data_from_webclient(page, error_callback=undefined) {
        const target_url = `${web_server_url}/${page}`;
        console.log("Получение данных по URL: " + target_url)
        try {
            const response = await fetch(target_url, {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
                credentials: "include" // для передачи куки
            });
            if (!response.ok) {
              if (error_callback) error_callback("Ошибка при приёме данных.");
              return;
            }
            return await response.json(); // Возвращаем json с данными, как ответ
        } catch (error) {
            if (error_callback) error_callback("Ошибка при приёме данных.");
        }
    }

    function logout() {
      window.location.href = web_server_url + "/logout";
    }
    function logout_all() {
      window.location.href = web_server_url + "/logout?all=true";
    }

    document.addEventListener("DOMContentLoaded", async function() {
      nameText = document.getElementById("nameText");
      emailText = document.getElementById("emailText");

      const data_response = await get_data_from_webclient("data");
      if (!data_response) logout();

      nameText.textContent = data_response["name"];
      emailText.textContent = data_response["email"];

      logoutButton = document.getElementById("logoutButton");
      logoutAllButton = document.getElementById("logoutAllButton");

      logoutButton.onclick = logout;
      logoutAllButton.onclick = logout_all;
    });
  </script>
</body>
</html>
